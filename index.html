<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>puer'd up</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" />
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      padding: 0;
      font-family: 'Inter', sans-serif;
      background: #0e0e0e;
      color: #eaeaea;
    }
    #app {
      padding: 20px;
      max-width: 100%;
    }
    h1 {
      font-size: 1.6rem;
      margin-bottom: 20px;
      color: #ffffff;
    }
    .filters {
      margin-bottom: 20px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    .filter-group {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    label {
      font-size: 1rem;
      color: #cccccc;
    }
    select, input[type="text"], input[type="number"] {
      padding: 12px;
      border-radius: 6px;
      border: none;
      background: #1a1a1a;
      color: #eaeaea;
    }
    .price-range {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    input[type="range"] {
      -webkit-appearance: none;
      appearance: none;
      width: 100%;
      height: 6px;
      border-radius: 3px;
      background: #444;
      outline: none;
    }
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      height: 16px;
      width: 16px;
      border-radius: 50%;
      background: #0088ff;
      cursor: pointer;
      box-shadow: 0 0 2px rgba(0,0,0,0.2);
    }
    .catalog {
      display: flex;
      flex-direction: column;
      gap: 14px;
    }
    .item {
      padding: 16px;
      background: #1a1a1a;
      border: 1px solid #2c2c2c;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.25);
      transition: transform 0.15s ease, box-shadow 0.15s ease;
    }
    .item:hover {
      transform: scale(1.02);
      box-shadow: 0 4px 12px rgba(0,0,0,0.35);
    }
    .item h2 {
      font-size: 1.2rem;
      margin: 0 0 6px;
      color: #ffffff;
    }
    .item p {
      margin: 0;
      font-size: 0.95rem;
      color: #cfcfcf;
    }
    .item button {
      margin-top: 8px;
      padding: 6px 10px;
      background: #ff4444;
      border: none;
      border-radius: 6px;
      color: white;
      cursor: pointer;
    }
    .item button.edit {
      background: #ffaa00;
      margin-right: 8px;
    }
    .admin-panel {
      margin-top: 30px;
      padding: 16px;
      background: #1a1a1a;
      border-radius: 10px;
    }
    .admin-panel h3 {
      margin-top: 0;
    }
    .admin-panel form {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .admin-panel button {
      padding: 10px;
      background: #0088ff;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    .admin-panel button:hover {
      background: #0077dd;
    }
  </style>
</head>
<body>
  <div id="app">
    <h1>üçµ puer'd up</h1>

    <div class="filters">
      <div class="filter-group">
        <label for="type">–¢–∏–ø —á–∞—è:</label>
        <select id="type">
          <option value="all">–í—Å–µ</option>
          <option value="shu">–®—É –ü—É—ç—Ä</option>
          <option value="sheng">–®—ç–Ω –ü—É—ç—Ä</option>
          <option value="oolong">–£–ª—É–Ω</option>
          <option value="white">–ë–µ–ª—ã–π</option>
        </select>
      </div>
      <div class="filter-group price-range">
        <label for="maxPrice">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞: <span id="maxValue">100 ‚ÇΩ</span></label>
        <input type="range" id="maxPrice" min="0" max="100" value="100">
      </div>
    </div>

    <div class="catalog" id="catalog"></div>

    <div class="admin-panel" style="display: none;">
      <h3>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h3>
      <form id="adminForm">
        <input type="text" id="adminName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —á–∞—è" required>
        <input type="text" id="adminDesc" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ" required>
        <input type="text" id="adminType" placeholder="–¢–∏–ø (shu/sheng/oolong/white)" required>
        <input type="number" id="adminPrice" placeholder="–¶–µ–Ω–∞ ‚ÇΩ/–≥" required>
        <button type="submit">–î–æ–±–∞–≤–∏—Ç—å / –û–±–Ω–æ–≤–∏—Ç—å —á–∞–π</button>
      </form>
    </div>
  </div>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script>
    const tg = window.Telegram.WebApp;
    tg.expand();
  
    const user = tg.initDataUnsafe?.user;
    const isAdmin = user && user.id === 1047807309;
  
    if (isAdmin) {
      document.querySelector('.admin-panel').style.display = 'block';
    }
  
    const catalogEl = document.getElementById('catalog');
    const typeFilter = document.getElementById('type');
    const maxPriceSlider = document.getElementById('maxPrice');
    const maxValue = document.getElementById('maxValue');
  
    const adminForm = document.getElementById('adminForm');
    const nameInput = document.getElementById('adminName');
    const descInput = document.getElementById('adminDesc');
    const typeInput = document.getElementById('adminType');
    const priceInput = document.getElementById('adminPrice');
  
    let editId = null;
  
    async function loadCatalog() {
      const res = await fetch('http://localhost:8080/api/teas');
      const data = await res.json();
      window.catalog = data;
      updateCatalog();
    }
  
    async function deleteTea(id) {
      await fetch(`http://localhost:8080/api/teas/${id}`, { method: 'DELETE' });
      loadCatalog();
    }
  
    function editTea(id) {
      const item = window.catalog.find(t => t.id === id);
      if (!item) return;
      nameInput.value = item.name;
      descInput.value = item.desc;
      typeInput.value = item.type;
      priceInput.value = item.price;
      editId = item.id;
    }
  
    adminForm.addEventListener('submit', async function (e) {
      e.preventDefault();
      const newTea = {
        name: nameInput.value,
        desc: descInput.value,
        type: typeInput.value,
        price: parseInt(priceInput.value)
      };
      if (editId) {
        await fetch(`http://localhost:8080/api/teas/${editId}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(newTea)
        });
      } else {
        await fetch('http://localhost:8080/api/teas', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(newTea)
        });
      }
      editId = null;
      adminForm.reset();
      loadCatalog();
    });
  
    function updateCatalog() {
      catalogEl.innerHTML = '';
      const selectedType = typeFilter.value;
      const max = parseInt(maxPriceSlider.value);
      maxValue.textContent = `${max} ‚ÇΩ`;
  
      const filtered = window.catalog.filter(item =>
        (selectedType === 'all' || item.type === selectedType) && item.price <= max
      );
  
      filtered.forEach(item => {
        const div = document.createElement('div');
        div.className = 'item';
        div.innerHTML = `
          <h2>${item.name}</h2>
          <p>${item.desc}</p>
          <p style="margin-top:6px; color: #999;">${item.price} ‚ÇΩ/–≥</p>
          ${isAdmin ? `<button class="edit" onclick="editTea(${item.id})">–ò–∑–º–µ–Ω–∏—Ç—å</button><button onclick="deleteTea(${item.id})">–£–¥–∞–ª–∏—Ç—å</button>` : ''}
        `;
        catalogEl.appendChild(div);
      });
    }
  
    maxPriceSlider.addEventListener('input', updateCatalog);
    typeFilter.addEventListener('change', updateCatalog);
  
    loadCatalog();
  </script>
  
</body>
</html>
